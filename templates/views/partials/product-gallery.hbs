<div id="colorway-container"></div>
{{# ifCond product.gallery.length '>' 1}}
    
    <div class="{{class}}">
        <div class="row" style="margin-top: 5px; margin-bottom: 15px">
            <div class="col-xs-12">
                <div class="col-md-12 btn-group" data-toggle="buttons">
					{{#everyNth product.gallery product.imagesPerColorSwatch}}
						{{#if isModZero}}
                        <div data-image-id="#product-{{n}}" class="image-toggler" style="float:left;">
							<img src="{{cloudinaryUrl this width=80}}"/>
						</div>
						{{/if}}
					{{/everyNth}}

                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(document).ready(function () {
            
			var imagesPerSwatch = 3;
			{{#if product.imagesPerColorSwatch}}
            	imagesPerSwatch = {{product.imagesPerColorSwatch}};
			{{/if}}
			var colorways = [];
			{{#if product.colorwaysArray}}
                colorways = {{{json product.colorwaysArray}}};
			{{/if}}
			//client-side init gallery;
			var gallery = [];
			//server-side render code to populate gallery.
			{{#each product.gallery}}
				gallery.push("{{{cloudinaryUrl this height=80}}}");
			{{/each}}

            (function($) {
                $.fn.colorway = function( options ) {

                    // Establish our default settings
                    var settings = $.extend({
                        content      : 'Hello, World!',
                        color        : null,
                        complete	 : null,
						container    : '#colorway-container'
                    }, options);

                    return this.each( function() {
                        $(settings.container).html( settings.content);

                        if ( settings.color ) {
                            $(this).css( 'color', settings.color );
                        }

                        if ( $.isFunction( settings.complete ) ) {
                            settings.complete.call(this);
                        }
                    });

                };
                $.fn.colorway.log = function() {
                    //console.log($(this));
                    return '<strong></strong>';
                };
            }(jQuery));

            for (var i = 0; i < gallery.length + imagesPerSwatch; i+=imagesPerSwatch) {
				
				var initColorway = (function(){
                    var content = '<div style="width:' + (imagesPerSwatch) * 80 + 'px; height:80px;">';

                    for (var j = i; j < i+imagesPerSwatch; j++) {
                        //thisGallery.push(gallery[i]);
                        //content += '<img style="width:80px;" class="image-toggler-popover" data-image-id="#product-' + j + '" src="' + gallery[j] + '"/>';
                        //content += '<div class="product-swatch-circle">'+j+'</div>'
                        content += j + ' - '
                    }
                    colorways.forEach(function(colorway){
                        if(colorway.productIndex !== undefined && colorway.productIndex == i) {
                            content += '<div class="colorway">' + colorway.color + '</div>';
                        }
                    });
                    content += '</div>';
                    $("[data-image-id='#product-" + i + "']").colorway({content:content});
					return function(){ return content;}
				})();

                $("[data-image-id='#product-" + i + "']")
				.on("mouseenter", function (e) {
                    var _this = this;
                    $('.image-toggle').hide();
					
                    $($(this).attr('data-image-id')).show();
					
					
					$(this).colorway.log();
					
					
					//disable popover on mobile.
					if(!Modernizr.touchevents){
                        $(this).popover("show");
					}
					
                    $('.image-toggler-popover').click(function (e) {
                        $('.image-toggle').hide();
                        $($(this).attr('data-image-id')).show();
						
                        /*setTimeout(function () {
							$(_this).popover("hide")
                        }, 1000);*/
                    });
                    
                    $(this).siblings(".popover").on("mouseleave", function () {
                        $(_this).popover('hide');
                    });
                }).on("mouseleave", function () {
                    var _this = this;
                    setTimeout(function () {
                        if (!$(".popover:hover").length) {
                            $(_this).popover("hide")
                        }
                    }, 100);
                }).on("click", function (event) {
                    var _this = this;
                    setTimeout(function () {
                        $(_this).popover("hide")
                    }, 200);
                });
				
			};
            /*$('.image-toggler').click(function (e) {
                $('.image-toggle').hide();
                $($(this).attr('data-image-id')).show();
            });*/

        });
    </script>
{{/ifCond}}
