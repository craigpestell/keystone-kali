<script type="text/javascript">
    $(document).ready(function () {
		$('#dealer-search-type').change(function(){
		    
		   $('#bh-sl-address').toggle().val("");
		   $('#bh-sl-search').toggle().val("");
		});
        $('#importDealers').click(function () {
            var dealers = [

			];
            dealers.forEach(function(d){
                var data = {};
                data.location = {};
                data.name = d["name"];
                data.location.street1 = d["address"];
                data.location.suburb = d["city"];
                //data.location.state = d["Mailing State/Province"];
                data.location.country = d["country"];
                data.location.postcode = d["zip"];
                data.phone = d["phone"];
                if(d["web"])data.web = d["web"];
				console.log('data',d);
                $.post('/api/dealers', data, function(responseData, textStatus){
                    console.log(textStatus);
                })
            });
            

        });
        $.ajax('/api/dealers', {
            success: function (data) {
//console.log(data.dealers);
                var mapDealers = [];
                var autoCompleteNames = [];
                data.dealers.forEach(function (dealer, i) {
                    if (dealer.location) {
                        autoCompleteNames.push(data.dealers[i].name);
                        data.dealers[i].address = dealer.location.street1;
                        data.dealers[i].address2 = dealer.location.street2;
                        data.dealers[i].city = dealer.location.suburb;
                        data.dealers[i].state = dealer.location.state;
                        data.dealers[i].postal = dealer.location.postcode;
                        if (dealer.location.geo) {
                            data.dealers[i].lng = parseFloat(dealer.location.geo[0]);
                            data.dealers[i].lat = parseFloat(dealer.location.geo[1]);
                            mapDealers.push(data.dealers[i]);
                        }
                    }
					autoCompleteNames = autoCompleteNames.sort().filter(function(elem, index, self) {
						return index == self.indexOf(elem);
					})
					$( "#bh-sl-search" ).autocomplete({
						source: autoCompleteNames
					}).keyup(function (e) {
						if(e.which === 13) {
							$("#bh-sl-search").autocomplete('close');
						};
					});
                });

                /*{"id":"1",
                 "name":"Chipotle Minneapolis",
                 "lat":"44.947464",
                 "lng":"-93.320826",
                 "address":"3040 Excelsior Blvd",
                 "address2":"",
                 "city":"Minneapolis",
                 "state":"MN",
                 "postal":"55416",
                 "phone":"612-922-6662",
                 "web":"http:\/\/www.chipotle.com",
                 "hours1":"Mon-Sun 11am-10pm",
                 "hours2":"",
                 "hours3":""}*/
                var stylesArray = [
                    {
                        featureType: "all",
                        stylers: [
                            {saturation: -80}
                        ]
                    }, {
                        featureType: "road.arterial",
                        elementType: "geometry",
                        stylers: [
                            {hue: "#00ffee"},
                            {saturation: 50}
                        ]
                    }, {
                        featureType: "poi.business",
                        elementType: "labels",
                        stylers: [
                            {visibility: "off"}
                        ]
                    }
                ];
                var options = {
                    autoComplete: true,
                    autoGeocode: true,
                    dataType: 'json',
                    dataRaw: mapDealers,
                    fullMapStart: true,
                    fullMapStartBlank: false,
                    fullMapStartListLimit: 100,
                    loading: true,
                    storeLimit: mapDealers.length,
                    slideMap: false,
                    mapSettings: {
                        zoom: 10,
                        mapTypeId: google.maps.MapTypeId.ROADMAP,
                        disableDefaultUI: true, // a way to quickly hide all controls
//mapTypeControl: true,
//scaleControl: true,
//zoomControl: true,
                        /*zoomControlOptions: {
                         style: google.maps.ZoomControlStyle.LARGE
                         },*/
                        styles: stylesArray,
                        scrollwheel: false
                    }
                };
                $('#bh-sl-map-container').storeLocator(options);
            }
        });
    });
</script>
